<!-- ‚úÖ customer-header.html (phi√™n b·∫£n fix c·ª©ng) -->
<header class="header cm-header">
    <div class="header-container">
        <!-- Logo -->
        <a href="../home/home.html" class="logo-text">CineMaster</a>

        <!-- Navigation -->
        <nav class="cm-nav">
            <a href="../home/home.html" class="nav-link">Trang ch·ªß</a>
            <a href="../movies/listMovieCus.html" class="nav-link">Phim</a>
            <a href="../user/showtimes-calendar.html" class="nav-link">L·ªãch chi·∫øu</a>
            <a href="../discount/listDiscount.html" class="nav-link">Khuy·∫øn m√£i</a>
            <a href="../news/listNewsCus.html" class="nav-link">Tin t·ª©c</a> <!-- üì∞ Th√™m m·ª•c Tin t·ª©c -->
            <a href="../contact/contact.html" class="nav-link">Li√™n h·ªá</a>
        </nav>



        <!-- Auth area -->
        <div class="auth-wrap" id="authArea"></div>
    </div>
</header>

<style>
    @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700;900&family=Bebas+Neue&display=swap');
    :root {
        --primary:#e50914;
        --text:#ffffff;
        --muted:#cfd8e3;
    }

    body { padding-top:96px; }

    .cm-header {
        position:fixed; inset:0 0 auto 0; z-index:100;
        background:rgba(10,19,38,.94);
        backdrop-filter:saturate(120%) blur(8px);
        color:var(--text);
        border-bottom:1px solid rgba(255,255,255,.06);
        box-shadow:0 10px 28px rgba(0,0,0,.45);
    }
    .cm-header::after{
        content:""; position:absolute; left:0; right:0; bottom:0; height:2px;
        background:linear-gradient(90deg,transparent,rgba(229,9,20,.65),rgba(34,193,255,.35),transparent);
    }

    .header-container{
        max-width:1300px; margin:0 auto;
        padding:18px 48px;
        display:flex; align-items:center; justify-content:space-between; gap:24px;
    }

    .logo-text{
        font-family:'Bebas Neue', sans-serif;
        letter-spacing:2.5px; font-size:2.4rem;
        color:var(--primary); text-decoration:none;
        text-shadow:0 0 10px rgba(229,9,20,.25);
    }

    .cm-nav{ display:flex; gap:28px; align-items:center; }
    .nav-link{
        position:relative; color:var(--muted);
        text-decoration:none; font-weight:600;
        font-size:1.05rem; transition:color .2s ease;
        padding:8px 2px;
    }
    .nav-link::after{
        content:""; position:absolute; left:0; right:0; bottom:-6px; height:2px;
        background:linear-gradient(90deg,rgba(229,9,20,.9),rgba(34,193,255,.6));
        transform:scaleX(0); transform-origin:left; transition:transform .2s ease;
    }
    .nav-link:hover,.nav-link.active{ color:#fff; }
    .nav-link:hover::after,.nav-link.active::after{ transform:scaleX(1); }

    .auth-wrap{ display:flex; align-items:center; gap:14px; }
    .btn-auth,.btn-auth-outline{
        padding:8px 16px; border-radius:22px; cursor:pointer;
        font-weight:800; transition:all .25s ease;
    }
    .btn-auth{
        border:1.8px solid var(--primary); color:var(--primary); background:transparent;
    }
    .btn-auth:hover{
        background:var(--primary); color:#fff;
        box-shadow:0 0 14px rgba(229,9,20,.55);
        transform:translateY(-1px);
    }
    .btn-auth-outline{
        border:1.8px solid #fff; color:#fff; background:transparent;
    }
    .btn-auth-outline:hover{
        background:rgba(255,255,255,.12);
        box-shadow:0 0 12px rgba(255,255,255,.3);
    }

    .user-info{ display:flex; align-items:center; gap:12px; position:relative; }
    .user-avatar{
        width:40px; height:40px; border-radius:50%;
        object-fit:cover; border:2px solid rgba(255,255,255,.15);
        background:#fff; cursor:pointer;
    }
    .user-name{ color:#eef3ff; font-weight:700; }

    .dropdown-menu{
        display:none; position:absolute; right:0; top:50px;
        background:rgba(15,22,40,.95); border:1px solid rgba(255,255,255,.1);
        border-radius:12px; min-width:180px;
        box-shadow:0 6px 20px rgba(0,0,0,.6);
        padding:10px 0; z-index:200;
    }
    .dropdown-menu.show{ display:block; animation:fadeIn .2s ease; }
    .dropdown-menu a{
        display:block; padding:10px 18px; color:#cfd8e3; text-decoration:none;
        font-weight:500; transition:background .25s ease,color .25s ease;
    }
    .dropdown-menu a:hover{
        background:rgba(255,255,255,.08); color:#fff;
    }
    .dropdown-menu hr{
        border:none; border-top:1px solid rgba(255,255,255,.1); margin:6px 0;
    }
    @keyframes fadeIn{
        from{opacity:0; transform:translateY(-5px);}
        to{opacity:1; transform:translateY(0);}
    }
    @media (max-width:960px){
        .cm-nav{ display:none; }
        .header-container{ padding:14px 20px; }
        body{ padding-top:78px; }
    }
</style>



<script>
    (function renderFixedHeader() {
        const authArea = document.getElementById("authArea");
        if (!authArea) return;

        const token = localStorage.getItem("accessToken");
        const name = localStorage.getItem("fullName") || "User";
        const storedAvatar = localStorage.getItem("avatarUrl");
        const accountId = localStorage.getItem("accountId");
        const role = localStorage.getItem("role"); // üëë Role hi·ªán t·∫°i

        // Avatar x·ª≠ l√Ω ƒë∆∞·ªùng d·∫´n
        let avatar = "../assets/default-avatar.png";
        if (storedAvatar) {
            if (storedAvatar.startsWith("/uploads/")) avatar = "http://localhost:8080" + storedAvatar;
            else if (storedAvatar.startsWith("http")) avatar = storedAvatar;
        }

        // N·∫øu ch∆∞a login
        if (!token) {
            authArea.innerHTML = `
            <button class="btn-auth" onclick="location.href='../user/login.html'">Login</button>
            <button class="btn-auth-outline" onclick="location.href='../user/register.html'">Register</button>
        `;
            return;
        }

        /* ============================================================
           X√°c ƒë·ªãnh n·∫øu ƒëang ·ªü dashboard (admin/manager/staff)
           ============================================================ */
        const currentPath = window.location.pathname;
        const isDashboard =
            currentPath.includes("dashboardAdmin") ||
            currentPath.includes("dashboardManager") ||
            currentPath.includes("dashboardStaff");

        /* ============================================================
           X√¢y d·ª±ng menu dropdown
           ============================================================ */
        let dropdownItems = `
        <a href="../user/profile.html?id=${accountId || ''}">üë§ Trang c√° nh√¢n </a>
        <hr>
        <a href="#" id="logoutBtn">üö™ ƒêƒÉng xu·∫•t</a>
    `;

        if (role === "Customer") {
            // üë§ Customer: c√≥ th√™m v√© & membership
            dropdownItems = `
            <a href="../user/profile.html?id=${accountId || ''}">üë§ Trang c√° nh√¢n</a>
            <a href="../tickets/myTickets.html">üéü V√© c·ªßa t√¥i</a>
            <a href="../user/membership.html">‚≠ê Th·∫ª th√†nh vi√™n</a>
            <hr>
            <a href="#" id="logoutBtn">üö™ ƒêƒÉng xu·∫•t</a>
        `;
        } else if (["Admin", "Manager", "Staff"].includes(role)) {
            // üßë‚Äçüíº Admin/Manager/Staff
            let dashboardLink = "";
            if (!isDashboard) {
                if (role === "Admin") dashboardLink = `<a href="/CineMaster/frontend/home/dashboardAdmin.html">üß≠ Trang qu·∫£n l√Ω</a>`;
                else if (role === "Manager") dashboardLink = `<a href="/CineMaster/frontend/home/dashboardManager.html">üß≠ Trang qu·∫£n l√Ω</a>`;
                else if (role === "Staff") dashboardLink = `<a href="/CineMaster/frontend/home/dashboardStaff.html">üß≠ Trang qu·∫£n l√Ω</a>`;
            }

            dropdownItems = `
            <a href="../user/profile.html?id=${accountId || ''}">üë§ Trang c√° nh√¢n</a>
            ${dashboardLink}
            <hr>
            <a href="#" id="logoutBtn">üö™ ƒêƒÉng xu·∫•t</a>
        `;
        }

        // ‚úÖ Render giao di·ªán header
        authArea.innerHTML = `
        <div class="user-info">
            <div class="user-dropdown">
                <img src="${avatar}" alt="avatar" class="user-avatar" id="userAvatar">
                <div class="dropdown-menu" id="dropdownMenu">${dropdownItems}</div>
            </div>
            <span class="user-name">${name}</span>
        </div>
    `;

        // Toggle dropdown
        const avatarEl = document.getElementById("userAvatar");
        const dropdown = document.getElementById("dropdownMenu");
        if (avatarEl && dropdown) {
            avatarEl.addEventListener("click", (e) => {
                e.stopPropagation();
                dropdown.classList.toggle("show");
            });
            document.addEventListener("click", () => dropdown.classList.remove("show"));
        }

        // Logout
        const logoutBtn = document.getElementById("logoutBtn");
        logoutBtn.addEventListener("click", (e) => {
            e.preventDefault();
            localStorage.clear();
            sessionStorage.clear();
            if (window.google?.accounts?.id) google.accounts.id.disableAutoSelect();
            location.href = "../user/login.html";
        });

        // Highlight menu active
        const current = window.location.pathname.split("/").pop();
        document.querySelectorAll(".cm-nav .nav-link").forEach(link => {
            if (link.getAttribute("href").includes(current)) link.classList.add("active");
        });

        // Update realtime avatar / name
        window.addEventListener("storage", (e) => {
            if (e.key === "avatarUrl" || e.key === "fullName") {
                const img = document.getElementById("userAvatar");
                const nameEl = document.querySelector(".user-name");
                if (e.key === "avatarUrl" && img) {
                    let newAvatar = e.newValue || "../assets/default-avatar.png";
                    if (newAvatar.startsWith("/uploads/")) newAvatar = "http://localhost:8080" + newAvatar;
                    img.src = newAvatar;
                }
                if (e.key === "fullName" && nameEl) nameEl.textContent = e.newValue || "User";
            }
        });
    })();
    // ‚úÖ L·∫Øng nghe s·ª± ki·ªán avatarUpdated ƒë·ªÉ c·∫≠p nh·∫≠t ngay l·∫≠p t·ª©c (khi ƒëang ·ªü c√πng trang)
    window.addEventListener("avatarUpdated", () => {
        const newUrl = localStorage.getItem("avatarUrl");
        const img = document.getElementById("userAvatar");
        if (img && newUrl) {
            let updated = newUrl;
            if (updated.startsWith("/uploads/")) updated = "http://localhost:8080" + updated;
            else if (!updated.startsWith("http")) updated = "/" + updated;
            img.src = updated + `?t=${Date.now()}`; // ch·ªëng cache
        }
    });


</script>


