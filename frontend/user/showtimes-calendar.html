<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8" />
    <title>CineMaster • Showtimes</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700;900&family=Bebas+Neue&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">

    <style>
        :root{ --red:#e50914; --cyan:#22c1ff; --blue:#0aa3ff; --ink:#06101f; --bg:#0b162c;
            --card:#0c1324; --border:#1b2b4a; --muted:#9aa7b3; --muted2:#cfe3ff;
            --glow:0 0 20px rgba(34,193,255,.35), 0 0 60px rgba(34,193,255,.15);
        }
        /* Tickets background */
        .tickets-wall{ position:fixed; inset:0; pointer-events:none; z-index:0; }
        .tickets-wall .tickets-layer{
            position:absolute; inset:-10%; background-repeat:repeat; background-size:320px 160px;
            opacity:.14; filter:drop-shadow(0 0 20px rgba(22,40,76,.18)); transform-origin:center center;
        }
        .tickets-wall .l1{
            transform:rotate(-3deg) scale(1.04);
            background-image:url("data:image/svg+xml;utf8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='320' height='160' viewBox='0 0 320 160'%3E%3Crect fill='none' width='320' height='160'/%3E%3Cg opacity='0.95'%3E%3Cg transform='translate(8,8)'%3E%3Cpath d='M0 24 a12 12 0 0 1 12 -12 h200 a10 10 0 0 0 10 -10 a12 12 0 0 1 12 12 v60 a12 12 0 0 1 -12 12 a10 10 0 0 0 -10 10 H12 a12 12 0 0 1 -12 -12z' fill='%23192A43' stroke='%232c3e66' stroke-width='2'/%3E%3Cline x1='140' y1='12' x2='140' y2='96' stroke='%238fb4ff' stroke-opacity='0.18' stroke-dasharray='6 6' /%3E%3Ccircle cx='60' cy='54' r='22' fill='none' stroke='%238fb4ff' stroke-opacity='0.35' stroke-width='3'/%3E%3Ccircle cx='60' cy='54' r='5' fill='%238fb4ff' opacity='0.3'/%3E%3Cg fill='%238fb4ff' opacity='0.35'%3E%3Ccircle cx='49' cy='44' r='5'/%3E%3Ccircle cx='71' cy='44' r='5'/%3E%3Ccircle cx='49' cy='64' r='5'/%3E%3Ccircle cx='71' cy='64' r='5'/%3E%3C/g%3E%3Cg transform='translate(164,32)' stroke='%23cfe3ff' stroke-opacity='0.38'%3E%3Crect x='0' y='0' width='60' height='24' fill='none'/%3E%3Cpath d='M3 0 v24 M8 0 v24 M11 0 v24 M16 0 v24 M22 0 v24 M27 0 v24 M33 0 v24 M38 0 v24 M45 0 v24 M51 0 v24 M56 0 v24' stroke-width='2'/%3E%3C/g%3E%3Cg transform='translate(164,66)' stroke='%23cfe3ff' stroke-opacity='0.45'%3E%3Cline x1='0' y1='0' x2='76' y2='0' stroke-width='2'/%3E%3Cline x1='0' y1='10' x2='62' y2='10' stroke-width='2'/%3E%3Cline x1='0' y1='20' x2='70' y2='20' stroke-width='2'/%3E%3C/g%3E%3C/g%3E%3Cg transform='translate(8,88)'%3E%3Cpath d='M0 24 a12 12 0 0 1 12 -12 h200 a10 10 0 0 0 10 -10 a12 12 0 0 1 12 12 v60 a12 12 0 0 1 -12 12 a10 10 0 0 0 -10 10 H12 a12 12 0 0 1 -12 -12z' fill='%231b2f50' stroke='%23314774' stroke-width='2'/%3E%3Cline x1='140' y1='12' x2='140' y2='96' stroke='%238fb4ff' stroke-opacity='0.18' stroke-dasharray='6 6'/%3E%3Ccircle cx='60' cy='54' r='22' fill='none' stroke='%23a8c8ff' stroke-opacity='0.32' stroke-width='3'/%3E%3Ccircle cx='60' cy='54' r='5' fill='%23a8c8ff' opacity='0.28'/%3E%3Cg fill='%23a8c8ff' opacity='0.32'%3E%3Ccircle cx='49' cy='44' r='5'/%3E%3Ccircle cx='71' cy='44' r='5'/%3E%3Ccircle cx='49' cy='64' r='5'/%3E%3Ccircle cx='71' cy='64' r='5'/%3E%3C/g%3E%3Cg transform='translate(164,32)' stroke='%23d8e6ff' stroke-opacity='0.38'%3E%3Cpath d='M3 0 v24 M8 0 v24 M11 0 v24 M16 0 v24 M22 0 v24 M27 0 v24 M33 0 v24 M38 0 v24 M45 0 v24 M51 0 v24 M56 0 v24' stroke-width='2'/%3E%3C/g%3E%3Cg transform='translate(164,66)' stroke='%23d8e6ff' stroke-opacity='0.45'%3E%3Cline x1='0' y1='0' x2='76' y2='0' stroke-width='2'/%3E%3Cline x1='0' y1='10' x2='62' y2='10' stroke-width='2'/%3E%3Cline x1='0' y1='20' x2='70' y2='20' stroke-width='2'/%3E%3C/g%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        }
        .tickets-wall .l2{ transform:rotate(3deg) scale(1.06); background-position:160px 80px; opacity:.10; background-image:inherit; }

        html,body{
            margin:0; color:#fff; font-family:'Roboto',system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
            min-height:100vh; background-color: var(--ink);
            background-image:
                    radial-gradient(1200px 600px at -10% -35%, rgba(229,9,20,.18), transparent 60%),
                    radial-gradient(900px 400px at 120% -20%, rgba(34,193,255,.12), transparent 60%),
                    linear-gradient(180deg, var(--ink), var(--bg)),
                    url("data:image/svg+xml;utf8,\
<svg xmlns='http://www.w3.org/2000/svg' width='160' height='80' viewBox='0 0 160 80'>\
<rect width='160' height='80' fill='none'/>\
<g opacity='0.08' stroke='%23cfe3ff' stroke-width='1.2' fill='none'>\
<path d='M8 20 h110 a10 10 0 0 0 10 -10 a10 10 0 0 1 10 10 v20 a10 10 0 0 1 -10 10 a10 10 0 0 0 -10 10 H8 z'/>\
<path d='M30 18 v44' stroke-dasharray='6 6'/>\
<circle cx='120' cy='20' r='3'/><circle cx='120' cy='60' r='3'/>\
</g></svg>");
            background-repeat:no-repeat,no-repeat,no-repeat,repeat;
            background-size:1200px 600px,900px 400px,100% 100%,320px 160px;
            background-position:-10% -35%,120% -20%,0 0,0 0;
            background-attachment:fixed, fixed, fixed, fixed;
            overflow-x:hidden;
        }

        .grain{ pointer-events:none; position:fixed; inset:0; opacity:.14; mix-blend-mode:screen;
            background-image:radial-gradient(circle at 20% 30%, rgba(255,255,255,.06) 0 2px, transparent 2px),
            radial-gradient(circle at 70% 60%, rgba(255,255,255,.05) 0 2px, transparent 2px);
            background-size:200px 200px, 260px 260px; animation: drift 18s linear infinite alternate;
        }
        @keyframes drift{ from{ transform: translate3d(0,0,0) } to{ transform: translate3d(30px,-25px,0) } }

        .shell{max-width:1300px;margin:110px auto 48px;padding:0 24px}

        .film{
            position:relative; background:linear-gradient(180deg,#0b152a,#0c162c);
            border:1px solid var(--border); border-radius:18px; box-shadow:0 14px 32px rgba(0,0,0,.5); overflow:hidden;
        }
        .film:before,.film:after{
            content:""; position:absolute; left:18px; right:18px; height:10px; opacity:.5;
            background:repeating-linear-gradient(90deg, #142443 0 16px, transparent 16px 32px);
            filter:drop-shadow(0 0 6px rgba(34,193,255,.2));
        }
        .film:before{ top:12px } .film:after{ bottom:12px }

        .schedule-panel{ padding:26px 22px; }
        .panel-head{ display:flex; align-items:center; gap:12px; margin-bottom:16px }
        .panel-head h2{ margin:0; font-weight:900; letter-spacing:.3px }

        .toolbar{ display:flex; gap:12px; flex-wrap:wrap; align-items:center; margin-bottom:14px }
        .select-branch,.legend{ background:#0e1c37; border:1px solid #17345f; color:#fff; border-radius:10px; padding:8px 12px; }
        .legend{ display:flex; gap:14px; align-items:center; font-size:.9rem }
        .legend .dot{ width:10px; height:10px; border-radius:50%; display:inline-block }

        .daybar{ display:flex; gap:8px; overflow:auto; padding:10px; margin:4px -6px 14px;
            background:linear-gradient(180deg,#0d1a33,#0a1427); border:1px solid var(--border); border-radius:14px; }
        .daybar .btn{ background:linear-gradient(180deg,#0d1a33,#0a1427); border:1px solid var(--border); color:#e6f1ff;
            border-radius:999px; padding:9px 14px; transition:.15s; }
        .daybar .btn:hover{ transform: translateY(-1px) }
        .daybar .btn.active{ color:#fff; border-color:var(--blue);
            box-shadow: 0 0 0 2px rgba(34,193,255,.18) inset, 0 0 24px rgba(34,193,255,.18); }
        .daybar .btn:disabled{ opacity:.5; cursor:not-allowed }

        .empty{ padding:26px; border:1px dashed #2a3d6a; border-radius:12px; color:#cfe3ff; text-align:center;
            background:linear-gradient(180deg,#0b152a 0,#0c162c 100%); }

        .movie-card{ background:#0e1d38; border:1px solid var(--border); border-radius:14px; padding:14px;
            box-shadow:0 10px 24px rgba(0,0,0,.35); transition:.2s; }
        .movie-card + .movie-card{ margin-top:14px }
        .movie-card:hover{ transform: translateY(-2px) }
        .movie-head{ display:flex; gap:14px; align-items:center; margin-bottom:10px }
        .poster{ width:74px; height:110px; border-radius:10px; overflow:hidden; background:#071021; border:1px solid #1b2b4a }
        .poster img{ width:100%; height:100%; object-fit:cover }
        .movie-title{ font-weight:800; letter-spacing:.2px }
        .slots{ display:flex; flex-wrap:wrap; gap:10px; }
        .slot{ display:inline-flex; gap:8px; align-items:center; padding:9px 12px; border-radius:10px;
            border:1px solid #1b3a6b; color:#e6f1ff; text-decoration:none; background:linear-gradient(180deg,#161a2a,#10182e); }
        .slot:hover{ border-color:var(--blue); box-shadow:0 0 0 1px rgba(34,193,255,.18) inset, var(--glow) }

        .footer-note{ color:var(--muted); font-size:.9rem; margin-top:10px }
        /* --- Slot + nút sửa cạnh nhau --- */
        .slot-wrap{ display:inline-flex; align-items:center; gap:6px }

        .slot-edit{
            padding:6px 8px;
            border-radius:8px;
            border:1px solid #2a3d6a;
            background:linear-gradient(180deg,#0d1a33,#0a1427);
            color:#cfe3ff;
            cursor:pointer;
        }
        .slot-edit:hover{
            border-color:var(--blue);
            box-shadow:0 0 0 1px rgba(34,193,255,.18) inset, var(--glow);
        }
        .slot-edit i{ font-size:12px; }

        .slot.disabled{ opacity:.45; cursor:not-allowed; pointer-events:none; border-color:#2a3d6a; filter:grayscale(0.25); }
    </style>
</head>
<body>
<div class="grain"></div>
<div class="tickets-wall" aria-hidden="true"><div class="tickets-layer l1"></div><div class="tickets-layer l2"></div></div>

<!-- header -->
<div id="site-header"></div>

<main class="shell">
    <section class="film schedule-panel">
        <div class="panel-head">
            <i class="fa-solid fa-clapperboard"></i>
            <h2>Lịch chiếu</h2>
        </div>

        <!-- Toolbar -->
        <div class="d-flex justify-content-between align-items-center mb-3">
            <div class="h5 m-0">Lịch chiếu theo tuần</div>
            <button id="btnOpenCreate" class="btn btn-primary">
                <i class="fa-solid fa-plus me-2"></i>Tạo lịch chiếu
            </button>
        </div>

        <div class="toolbar">
            <select id="branchSelect" class="select-branch">
                <option value="">Tất cả rạp</option>
            </select>

        </div>

        <!-- Day selector -->
        <div id="dayButtons" class="daybar"></div>

        <!-- Nội dung theo ngày -->
        <div id="contentArea"></div>

        <div class="footer-note">
            * Click giờ chiếu để đi tới trang đặt vé.
        </div>
    </section>
</main>

<!-- footer -->
<div id="site-footer"></div>

<!-- 1) Bootstrap bundle (để dùng bootstrap.Modal) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/js/bootstrap.bundle.min.js"></script>

<!-- 2) Load shared header/footer (script THƯỜNG, KHÔNG import) -->
<script>
    (async ()=> {
        try{
            const [h,f] = await Promise.all([
                fetch('../home/customer-header.html').then(r=>r.text()),
                fetch('../home/footer.html').then(r=>r.text())
            ]);
            document.getElementById('site-header').innerHTML = h;
            document.getElementById('site-footer').innerHTML = f;
        }catch(e){ console.error('Load header/footer error', e); }
    })();
</script>

<!-- 3) Khởi tạo modal tạo lịch chiếu (MODULE) -->
<!-- 3) Khởi tạo modal tạo lịch chiếu (MODULE) -->
<script type="module">
    import { initShowtimeCreate, openShowtimeCreate } from "../js/showtime-create.js";
    import { initShowtimeEdit,   openShowtimeEdit   } from "../js/showtime-edit.js";

    // 🔹 Lấy role người dùng hiện tại
    const role = localStorage.getItem("role");
    const btnCreate = document.getElementById("btnOpenCreate");

    // 🔹 Nếu là Staff hoặc Customer → ẩn hoàn toàn nút
    if (role === "Staff" || role === "Customer") {
        if (btnCreate) btnCreate.style.display = "none";
    } else {
        // ✅ Chỉ khi Admin/Manager mới gán sự kiện mở modal tạo
        btnCreate?.addEventListener("click", () => {
            const selectedDay   = window.__calendarSelectedYMD || null;
            const currentBranch = document.getElementById("branchSelect")?.value || "";
            openShowtimeCreate({ defaultDate: selectedDay, branchId: currentBranch || null });
        });
    }

    // ✅ Khởi tạo modal tạo / sửa
    await initShowtimeCreate({ htmlPath: './showtime-create.html' });
    await initShowtimeEdit({   htmlPath: './showtime-edit.html'   });

    // Cho calendar gọi khi cần sửa/xóa
    window.openShowtimeEdit = openShowtimeEdit;

    // ✅ Reload lịch chiếu khi tạo/sửa/xóa
    const reload = () => window.reloadCalendar?.();
    window.addEventListener('showtime:created', reload);
    window.addEventListener('showtime:updated', reload);
    window.addEventListener('showtime:deleted', reload);
</script>


<!-- 4) App lịch chiếu (MODULE) -->
<script type="module" src="../js/showtimes-calendar.js"></script>

</body>
</html>
