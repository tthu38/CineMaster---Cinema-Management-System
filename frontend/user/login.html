<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>ƒêƒÉng nh·∫≠p</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        .input-group-text { background-color: #e9ecef; }
        .social-login .btn { border: 1px solid #dee2e6; transition: all 0.2s; }
        .social-login .btn:hover { box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); }
        .card { border-radius: 1rem; }
    </style>
</head>
<body class="bg-light d-flex align-items-center justify-content-center" style="height: 100vh;">

<div class="card p-5 shadow-lg" style="width: 28rem;">
    <h1 class="card-title text-center mb-4 text-primary fw-bold">üîê ƒêƒÉng nh·∫≠p</h1>

    <!-- Th√¥ng b√°o l·ªói -->
    <div id="error-message" class="alert alert-danger text-center d-none"></div>

    <form id="loginForm">
        <div class="mb-3 input-group">
            <span class="input-group-text"><i class="fas fa-user"></i></span>
            <input type="text" class="form-control" id="username" name="username" placeholder="T√™n ƒëƒÉng nh·∫≠p" required>
        </div>
        <div class="mb-3 input-group">
            <span class="input-group-text"><i class="fas fa-lock"></i></span>
            <input type="password" class="form-control" id="password" name="password" placeholder="M·∫≠t kh·∫©u" required>
        </div>

        <button id="loginBtn" type="submit" class="btn btn-primary w-100 mb-3 fw-bold">
            ƒêƒÉng nh·∫≠p
        </button>
    </form>

    <div class="text-center my-3 text-muted">Ho·∫∑c</div>
    <div class="d-grid social-login">
        <!-- ‚úÖ ƒë·ªïi l·∫°i URL Google login ƒë·ªÉ n√≥ redirect v·ªÅ profile.html sau khi login -->
        <a href="http://localhost:8081/demo/oauth2/authorization/google"
           class="btn btn-light d-flex align-items-center justify-content-center py-2">
            <img src="https://www.google.com/favicon.ico" alt="Google" style="width:20px;margin-right:10px;">
            ƒêƒÉng nh·∫≠p v·ªõi Google
        </a>

    </div>
</div>

<script>
    const loginForm = document.getElementById("loginForm");
    const loginBtn = document.getElementById("loginBtn");
    const errorMsg = document.getElementById("error-message");

    loginForm.addEventListener("submit", async function (e) {
        e.preventDefault();

        const username = document.getElementById("username").value.trim();
        const password = document.getElementById("password").value.trim();

        // Reset th√¥ng b√°o l·ªói
        errorMsg.classList.add("d-none");
        errorMsg.innerText = "";

        // Loading state
        loginBtn.disabled = true;
        loginBtn.innerHTML = `<span class="spinner-border spinner-border-sm"></span> ƒêang ƒëƒÉng nh·∫≠p...`;

        try {
            const response = await fetch("http://localhost:8081/demo/login", {
                method: "POST",
                headers: { "Content-Type": "application/x-www-form-urlencoded" },
                body: new URLSearchParams({ username, password }),
                credentials: "include"
            });

            let data = {};
            try {
                data = await response.json();
            } catch {
                data = {};
            }

            if (response.ok && data.status === "success") {
                // ‚úÖ L∆∞u username ƒë·ªÉ hi·ªÉn th·ªã trong profile
                localStorage.setItem("username", data.username);

                // ‚úÖ FE t·ª± redirect sang profile.html trong d·ª± √°n frontend c·ªßa b·∫°n
                window.location.href = "http://localhost:63342/CineMaster/frontend/user/profile.html";
            } else {
                // Hi·ªÉn th·ªã l·ªói t·ª´ backend
                errorMsg.classList.remove("d-none");
                errorMsg.innerText = data.message || data.error || "Sai t√†i kho·∫£n ho·∫∑c m·∫≠t kh·∫©u!";
            }
        } catch (err) {
            errorMsg.classList.remove("d-none");
            errorMsg.innerText = "L·ªói k·∫øt n·ªëi ƒë·∫øn server!";
            console.error(err);
        } finally {
            // Reset n√∫t
            loginBtn.disabled = false;
            loginBtn.innerHTML = "ƒêƒÉng nh·∫≠p";
        }
    });
</script>

</body>
</html>
