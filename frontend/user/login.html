<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>ƒêƒÉng nh·∫≠p</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        .input-group-text { background-color: #e9ecef; }
        .social-login .btn { border: 1px solid #dee2e6; transition: all 0.2s; }
        .social-login .btn:hover { box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); }
        .card { border-radius: 1rem; }
    </style>
</head>
<body class="bg-light d-flex align-items-center justify-content-center" style="height: 100vh;">

<div class="card p-5 shadow-lg" style="width: 28rem;">
    <h1 class="card-title text-center mb-4 text-primary fw-bold">üîê ƒêƒÉng nh·∫≠p</h1>

    <!-- Th√¥ng b√°o l·ªói -->
    <div id="error-message" class="alert alert-danger text-center d-none"></div>

    <form id="loginForm">
        <div class="mb-3 input-group">
            <span class="input-group-text"><i class="fas fa-user"></i></span>
            <input type="text" class="form-control" id="username" name="username" placeholder="T√™n ƒëƒÉng nh·∫≠p" required>
        </div>
        <div class="mb-3 input-group">
            <span class="input-group-text"><i class="fas fa-lock"></i></span>
            <input type="password" class="form-control" id="password" name="password" placeholder="M·∫≠t kh·∫©u" required>
        </div>

        <button id="loginBtn" type="submit" class="btn btn-primary w-100 mb-3 fw-bold">
            ƒêƒÉng nh·∫≠p
        </button>
    </form>

    <div class="text-center my-3 text-muted">Ho·∫∑c</div>
    <div class="d-grid social-login">
        <!-- ‚úÖ ƒë·ªïi l·∫°i URL Google login ƒë·ªÉ n√≥ redirect v·ªÅ profile.html sau khi login -->
        <a href="http://localhost:8081/demo/oauth2/authorization/google"
           class="btn btn-light d-flex align-items-center justify-content-center py-2">
            <img src="https://www.google.com/favicon.ico" alt="Google" style="width:20px;margin-right:10px;">
            ƒêƒÉng nh·∫≠p v·ªõi Google
        </a>

    </div>
</div>

<script>
    async function loadProfile() {
        try {
            const res = await fetch("http://localhost:8081/api/auth/me", {
                credentials: "include" // g·ª≠i cookie session t·ªõi backend
            });
            const data = await res.json();

            const userInfoDiv = document.getElementById("user-info");

            if (data.status === "authenticated") {
                // L∆∞u username v√†o localStorage (ph√≤ng khi mu·ªën d√πng sau)
                localStorage.setItem("username", data.username);

                userInfoDiv.innerHTML = `
                    <p><strong>Tr·∫°ng th√°i:</strong> ${data.status}</p>
                    <p><strong>T√†i kho·∫£n:</strong> ${data.username}</p>
                `;
            } else {
                // N·∫øu ch∆∞a login ‚Üí quay l·∫°i trang ƒëƒÉng nh·∫≠p
                window.location.href = "login.html";
            }
        } catch (err) {
            console.error("L·ªói khi t·∫£i th√¥ng tin user:", err);
            window.location.href = "login.html";
        }
    }

    // G·ªçi API logout
    document.getElementById("logoutBtn").addEventListener("click", async () => {
        await fetch("http://localhost:8081/api/auth/logout", {
            method: "POST",
            credentials: "include"
        });
        localStorage.removeItem("username");
        window.location.href = "login.html";
    });

    // Load th√¥ng tin khi m·ªü trang
    loadProfile();
</script>

</body>
</html>
